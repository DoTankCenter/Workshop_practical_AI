<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professionell F√§rgpalett Designer</title>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #2d3748;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
    }

    header {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        text-align: center;
    }

    h1 {
        font-size: 2.5rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .subtitle {
        color: #718096;
        font-size: 1.1rem;
    }

    .main-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }

    @media (max-width: 768px) {
        .main-grid {
            grid-template-columns: 1fr;
        }
    }

    .panel {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .panel h2 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        color: #2d3748;
    }

    .color-selectors {
        display: grid;
        gap: 2rem;
    }

    .selector-card {
        background: #f7fafc;
        border-radius: 15px;
        padding: 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .selector-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .selector-card h3 {
        font-size: 1.1rem;
        margin-bottom: 1rem;
        color: #4a5568;
    }

    .color-wheel {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: conic-gradient(
            hsl(0, 100%, 50%),
            hsl(30, 100%, 50%),
            hsl(60, 100%, 50%),
            hsl(90, 100%, 50%),
            hsl(120, 100%, 50%),
            hsl(150, 100%, 50%),
            hsl(180, 100%, 50%),
            hsl(210, 100%, 50%),
            hsl(240, 100%, 50%),
            hsl(270, 100%, 50%),
            hsl(300, 100%, 50%),
            hsl(330, 100%, 50%),
            hsl(360, 100%, 50%)
        );
        position: relative;
        cursor: crosshair;
        margin: 0 auto;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }

    .brightness-slider {
        width: 200px;
        margin: 1rem auto 0;
    }

    .linear-gradient {
        width: 100%;
        height: 60px;
        background: linear-gradient(to right,
            hsl(0, 100%, 50%),
            hsl(60, 100%, 50%),
            hsl(120, 100%, 50%),
            hsl(180, 100%, 50%),
            hsl(240, 100%, 50%),
            hsl(300, 100%, 50%),
            hsl(360, 100%, 50%)
        );
        border-radius: 10px;
        cursor: crosshair;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .lab-controls {
        display: grid;
        gap: 1rem;
    }

    .lab-slider {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .lab-slider label {
        font-weight: 600;
        width: 80px;
        color: #4a5568;
    }

    .lab-slider input[type="range"] {
        flex: 1;
    }

    .lab-slider .value {
        width: 50px;
        text-align: right;
        font-weight: 500;
    }

    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: #cbd5e0;
        border-radius: 4px;
        outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: #667eea;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .color-display {
        background: #f7fafc;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .color-preview-large {
        width: 100%;
        height: 150px;
        border-radius: 10px;
        margin-bottom: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: all 0.3s ease;
    }

    .color-values {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
    }

    .color-value {
        background: white;
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
    }

    .color-value label {
        font-size: 0.875rem;
        color: #718096;
        display: block;
        margin-bottom: 0.25rem;
    }

    .color-value .value {
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: #2d3748;
    }

    .color-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        margin-top: 0.5rem;
        transition: border-color 0.3s ease;
    }

    .color-input:focus {
        outline: none;
        border-color: #667eea;
    }

    .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .button-secondary {
        background: #4a5568;
    }

    .button-group {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .palette-builder {
        margin-top: 2rem;
    }

    .current-palette {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        min-height: 60px;
        background: #f7fafc;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1rem;
    }

    .palette-color {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        position: relative;
        cursor: pointer;
        transition: transform 0.2s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .palette-color:hover {
        transform: scale(1.1);
    }

    .palette-color .remove {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 20px;
        height: 20px;
        background: #fc5c65;
        color: white;
        border-radius: 50%;
        display: none;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 12px;
    }

    .palette-color:hover .remove {
        display: flex;
    }

    .saved-palettes {
        margin-top: 2rem;
    }

    .saved-palette-item {
        background: #f7fafc;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s ease;
    }

    .saved-palette-item:hover {
        transform: translateX(5px);
    }

    .palette-info {
        flex: 1;
    }

    .palette-name {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #2d3748;
    }

    .palette-colors {
        display: flex;
        gap: 0.25rem;
    }

    .palette-color-small {
        width: 30px;
        height: 30px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .palette-actions {
        display: flex;
        gap: 0.5rem;
    }

    .icon-button {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        border: none;
        background: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
    }

    .icon-button:hover {
        background: #edf2f7;
    }

    .file-actions {
        background: rgba(255, 255, 255, 0.98);
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
    }

    .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
    }

    .file-input-wrapper input[type=file] {
        position: absolute;
        left: -9999px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        padding: 2rem;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .tooltip {
        position: absolute;
        background: #2d3748;
        color: white;
        padding: 0.5rem;
        border-radius: 5px;
        font-size: 0.875rem;
        pointer-events: none;
        z-index: 100;
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .tooltip.visible {
        opacity: 1;
    }
</style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Professionell F√§rgpalett Designer</h1>
            <p class="subtitle">Skapa, hantera och exportera dina f√§rgpaletter med LAB-f√§rgrymd</p>
        </header>

        <div class="file-actions panel">
            <h2>Filhantering</h2>
            <div class="button-group">
                <button class="button button-secondary" onclick="exportAllPalettes()">
                    üì• Exportera alla paletter (JSON)
                </button>
                <div class="file-input-wrapper">
                    <button class="button button-secondary">
                        üì§ Importera paletter (JSON)
                    </button>
                    <input type="file" id="import-file" accept=".json" onchange="importPalettes(event)">
                </div>
                <button class="button button-secondary" onclick="clearAllPalettes()">
                    üóëÔ∏è Rensa alla paletter
                </button>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2>F√§rgv√§ljare</h2>
                
                <div class="color-selectors">
                    <div class="selector-card">
                        <h3>HSL F√§rghjul</h3>
                        <div class="color-wheel" id="color-wheel"></div>
                        <div class="brightness-slider">
                            <label>Ljusstyrka:</label>
                            <input type="range" id="lightness" min="0" max="100" value="50">
                        </div>
                    </div>

                    <div class="selector-card">
                        <h3>Spektrum</h3>
                        <div class="linear-gradient" id="linear-gradient"></div>
                        <div style="margin-top: 1rem;">
                            <label>M√§ttnad:</label>
                            <input type="range" id="saturation" min="0" max="100" value="100" style="width: 100%;">
                        </div>
                    </div>

                    <div class="selector-card">
                        <h3>LAB F√§rgrymd</h3>
                        <div class="lab-controls">
                            <div class="lab-slider">
                                <label>L* (Ljushet):</label>
                                <input type="range" id="lab-l" min="0" max="100" value="50">
                                <span class="value" id="lab-l-value">50</span>
                            </div>
                            <div class="lab-slider">
                                <label>a* (Gr√∂n-R√∂d):</label>
                                <input type="range" id="lab-a" min="-128" max="127" value="0">
                                <span class="value" id="lab-a-value">0</span>
                            </div>
                            <div class="lab-slider">
                                <label>b* (Bl√•-Gul):</label>
                                <input type="range" id="lab-b" min="-128" max="127" value="0">
                                <span class="value" id="lab-b-value">0</span>
                            </div>
                        </div>
                        <div id="lab-preview" style="width: 100%; height: 60px; border-radius: 10px; margin-top: 1rem; box-shadow: 0 3px 10px rgba(0,0,0,0.2);"></div>
                    </div>
                </div>
            </div>

            <div class="panel">
                <h2>Vald f√§rg</h2>
                
                <div class="color-display">
                    <div class="color-preview-large" id="color-preview"></div>
                    
                    <div class="color-values">
                        <div class="color-value">
                            <label>HEX</label>
                            <div class="value" id="hex-value">#000000</div>
                        </div>
                        <div class="color-value">
                            <label>RGB</label>
                            <div class="value" id="rgb-value">0, 0, 0</div>
                        </div>
                        <div class="color-value">
                            <label>HSL</label>
                            <div class="value" id="hsl-value">0¬∞, 0%, 0%</div>
                        </div>
                        <div class="color-value">
                            <label>LAB</label>
                            <div class="value" id="lab-value">0, 0, 0</div>
                        </div>
                    </div>
                    
                    <input type="text" class="color-input" id="color-name" placeholder="Namnge f√§rgen (valfritt)">
                    <button class="button" onclick="addToPalette()" style="width: 100%; margin-top: 1rem;">
                        ‚ûï L√§gg till i palett
                    </button>
                </div>

                <div class="palette-builder">
                    <h3 style="margin-bottom: 1rem;">Bygg din palett</h3>
                    <div class="current-palette" id="current-palette"></div>
                    <input type="text" class="color-input" id="palette-name" placeholder="Namnge paletten">
                    <div class="button-group">
                        <button class="button" onclick="savePalette()">üíæ Spara palett</button>
                        <button class="button button-secondary" onclick="clearCurrentPalette()">üóëÔ∏è Rensa</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel saved-palettes">
            <h2>Sparade paletter</h2>
            <div id="saved-palettes"></div>
        </div>
    </div>

    <div class="modal" id="export-modal">
        <div class="modal-content">
            <h3>Exporterad JSON</h3>
            <textarea id="export-json" style="width: 100%; height: 300px; margin: 1rem 0; font-family: monospace;"></textarea>
            <div class="button-group">
                <button class="button" onclick="copyToClipboard()">üìã Kopiera</button>
                <button class="button" onclick="downloadJSON()">üíæ Ladda ner</button>
                <button class="button button-secondary" onclick="closeModal()">St√§ng</button>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

<script>
// Globala variabler
let currentColor = { hex: '#667eea', rgb: {r:102, g:126, b:234}, hsl: {h:230, s:76, l:66}, lab: {l:54, a:21, b:-58} };
let currentPalette = [];
let savedPalettes = [];

// LAB till RGB konvertering
function labToRgb(l, a, b) {
    // LAB till XYZ
    let y = (l + 16) / 116;
    let x = a / 500 + y;
    let z = y - b / 200;

    const delta = 6 / 29;
    const delta3 = Math.pow(delta, 3);
    
    if (x > delta) x = Math.pow(x, 3);
    else x = (x - 16/116) * 3 * delta * delta;
    
    if (y > delta) y = Math.pow(y, 3);
    else y = (y - 16/116) * 3 * delta * delta;
    
    if (z > delta) z = Math.pow(z, 3);
    else z = (z - 16/116) * 3 * delta * delta;

    // Referensv√§rden f√∂r D65 ljusk√§lla
    x *= 95.047;
    y *= 100.000;
    z *= 108.883;

    // XYZ till RGB
    let r = x * 3.2406 + y * -1.5372 + z * -0.4986;
    let g = x * -0.9689 + y * 1.8758 + z * 0.0415;
    let bl = x * 0.0557 + y * -0.2040 + z * 1.0570;

    // Gamma-korrigering
    r = r > 0.0031308 ? 1.055 * Math.pow(r/100, 1/2.4) - 0.055 : 12.92 * r/100;
    g = g > 0.0031308 ? 1.055 * Math.pow(g/100, 1/2.4) - 0.055 : 12.92 * g/100;
    bl = bl > 0.0031308 ? 1.055 * Math.pow(bl/100, 1/2.4) - 0.055 : 12.92 * bl/100;

    return {
        r: Math.max(0, Math.min(255, Math.round(r * 255))),
        g: Math.max(0, Math.min(255, Math.round(g * 255))),
        b: Math.max(0, Math.min(255, Math.round(bl * 255)))
    };
}

// RGB till LAB konvertering
function rgbToLab(r, g, b) {
    // RGB till XYZ
    r = r / 255;
    g = g / 255;
    b = b / 255;

    r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
    g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
    b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;

    let x = (r * 0.4124 + g * 0.3576 + b * 0.1805) * 100;
    let y = (r * 0.2126 + g * 0.7152 + b * 0.0722) * 100;
    let z = (r * 0.0193 + g * 0.1192 + b * 0.9505) * 100;

    // Normalisera med D65 ljusk√§lla
    x = x / 95.047;
    y = y / 100.000;
    z = z / 108.883;

    // XYZ till LAB
    const delta = 6 / 29;
    const delta3 = Math.pow(delta, 3);
    
    x = x > delta3 ? Math.pow(x, 1/3) : (x / (3 * delta * delta)) + 16/116;
    y = y > delta3 ? Math.pow(y, 1/3) : (y / (3 * delta * delta)) + 16/116;
    z = z > delta3 ? Math.pow(z, 1/3) : (z / (3 * delta * delta)) + 16/116;

    return {
        l: Math.round((116 * y) - 16),
        a: Math.round(500 * (x - y)),
        b: Math.round(200 * (y - z))
    };
}

// RGB till HEX
function rgbToHex(r, g, b) {
    return '#' + [r, g, b].map(x => {
        const hex = x.toString(16);
        return hex.length === 1 ? '0' + hex : hex;
    }).join('');
}

// HEX till RGB
function hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}

// RGB till HSL
function rgbToHsl(r, g, b) {
    r /= 255;
    g /= 255;
    b /= 255;

    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0;
    } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        
        switch (max) {
            case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
            case g: h = ((b - r) / d + 2) / 6; break;
            case b: h = ((r - g) / d + 4) / 6; break;
        }
    }

    return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        l: Math.round(l * 100)
    };
}

// HSL till RGB
function hslToRgb(h, s, l) {
    h = h / 360;
    s = s / 100;
    l = l / 100;

    let r, g, b;

    if (s === 0) {
        r = g = b = l;
    } else {
        const hue2rgb = (p, q, t) => {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1/6) return p + (q - p) * 6 * t;
            if (t < 1/2) return q;
            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
        };

        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
    }

    return {
        r: Math.round(r * 255),
        g: Math.round(g * 255),
        b: Math.round(b * 255)
    };
}

// Uppdatera f√§rgvisning
function updateColorDisplay(color) {
    currentColor = color;
    
    // Uppdatera f√∂rhandsvisning
    document.getElementById('color-preview').style.backgroundColor = color.hex;
    
    // Uppdatera v√§rden
    document.getElementById('hex-value').textContent = color.hex;
    document.getElementById('rgb-value').textContent = `${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b}`;
    document.getElementById('hsl-value').textContent = `${color.hsl.h}¬∞, ${color.hsl.s}%, ${color.hsl.l}%`;
    document.getElementById('lab-value').textContent = `${color.lab.l}, ${color.lab.a}, ${color.lab.b}`;
    
    // Uppdatera LAB-reglage
    document.getElementById('lab-l').value = color.lab.l;
    document.getElementById('lab-a').value = color.lab.a;
    document.getElementById('lab-b').value = color.lab.b;
    document.getElementById('lab-l-value').textContent = color.lab.l;
    document.getElementById('lab-a-value').textContent = color.lab.a;
    document.getElementById('lab-b-value').textContent = color.lab.b;
    document.getElementById('lab-preview').style.backgroundColor = color.hex;
}

// Skapa f√§rg fr√•n RGB
function createColorFromRgb(r, g, b) {
    const hex = rgbToHex(r, g, b);
    const hsl = rgbToHsl(r, g, b);
    const lab = rgbToLab(r, g, b);
    
    return { hex, rgb: {r, g, b}, hsl, lab };
}

// Skapa f√§rg fr√•n LAB
function createColorFromLab(l, a, b) {
    const rgb = labToRgb(l, a, b);
    const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
    const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
    
    return { hex, rgb, hsl, lab: {l, a, b} };
}

// Event listeners f√∂r f√§rghjulet
document.getElementById('color-wheel').addEventListener('click', function(e) {
    const rect = this.getBoundingClientRect();
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    const x = e.clientX - rect.left - centerX;
    const y = e.clientY - rect.top - centerY;
    
    const angle = Math.atan2(y, x);
    const hue = (angle * 180 / Math.PI + 360) % 360;
    const lightness = parseInt(document.getElementById('lightness').value);
    
    const rgb = hslToRgb(hue, 100, lightness);
    const color = createColorFromRgb(rgb.r, rgb.g, rgb.b);
    updateColorDisplay(color);
});

// Event listener f√∂r ljusstyrka
document.getElementById('lightness').addEventListener('input', function() {
    const lightness = parseInt(this.value);
    const rgb = hslToRgb(currentColor.hsl.h, currentColor.hsl.s, lightness);
    const color = createColorFromRgb(rgb.r, rgb.g, rgb.b);
    updateColorDisplay(color);
});

// Event listener f√∂r linj√§r gradient
document.getElementById('linear-gradient').addEventListener('click', function(e) {
    const rect = this.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const percentage = x / rect.width;
    const hue = percentage * 360;
    const saturation = parseInt(document.getElementById('saturation').value);
    
    const rgb = hslToRgb(hue, saturation, 50);
    const color = createColorFromRgb(rgb.r, rgb.g, rgb.b);
    updateColorDisplay(color);
});

// Event listener f√∂r m√§ttnad
document.getElementById('saturation').addEventListener('input', function() {
    const saturation = parseInt(this.value);
    const rgb = hslToRgb(currentColor.hsl.h, saturation, currentColor.hsl.l);
    const color = createColorFromRgb(rgb.r, rgb.g, rgb.b);
    updateColorDisplay(color);
});

// LAB-reglage
document.getElementById('lab-l').addEventListener('input', function() {
    const l = parseInt(this.value);
    const a = parseInt(document.getElementById('lab-a').value);
    const b = parseInt(document.getElementById('lab-b').value);
    
    document.getElementById('lab-l-value').textContent = l;
    const color = createColorFromLab(l, a, b);
    updateColorDisplay(color);
});

document.getElementById('lab-a').addEventListener('input', function() {
    const l = parseInt(document.getElementById('lab-l').value);
    const a = parseInt(this.value);
    const b = parseInt(document.getElementById('lab-b').value);
    
    document.getElementById('lab-a-value').textContent = a;
    const color = createColorFromLab(l, a, b);
    updateColorDisplay(color);
});

document.getElementById('lab-b').addEventListener('input', function() {
    const l = parseInt(document.getElementById('lab-l').value);
    const a = parseInt(document.getElementById('lab-a').value);
    const b = parseInt(this.value);
    
    document.getElementById('lab-b-value').textContent = b;
    const color = createColorFromLab(l, a, b);
    updateColorDisplay(color);
});

// L√§gg till f√§rg i palett
function addToPalette() {
    const name = document.getElementById('color-name').value || currentColor.hex;
    currentPalette.push({
        name: name,
        hex: currentColor.hex,
        rgb: currentColor.rgb,
        hsl: currentColor.hsl,
        lab: currentColor.lab
    });
    
    renderCurrentPalette();
    document.getElementById('color-name').value = '';
}

// Rendera aktuell palett
function renderCurrentPalette() {
    const container = document.getElementById('current-palette');
    container.innerHTML = '';
    
    if (currentPalette.length === 0) {
        container.innerHTML = '<div style="color: #a0aec0; text-align: center; width: 100%;">Din palett √§r tom</div>';
        return;
    }
    
    currentPalette.forEach((color, index) => {
        const div = document.createElement('div');
        div.className = 'palette-color';
        div.style.backgroundColor = color.hex;
        div.title = `${color.name}\nHEX: ${color.hex}\nRGB: ${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b}\nLAB: ${color.lab.l}, ${color.lab.a}, ${color.lab.b}`;
        
        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove';
        removeBtn.innerHTML = '√ó';
        removeBtn.onclick = () => removeFromPalette(index);
        
        div.appendChild(removeBtn);
        container.appendChild(div);
    });
}

// Ta bort f√§rg fr√•n palett
function removeFromPalette(index) {
    currentPalette.splice(index, 1);
    renderCurrentPalette();
}

// Rensa aktuell palett
function clearCurrentPalette() {
    currentPalette = [];
    renderCurrentPalette();
}

// Spara palett
function savePalette() {
    if (currentPalette.length === 0) {
        alert('Paletten √§r tom!');
        return;
    }
    
    const name = document.getElementById('palette-name').value || `Palett ${savedPalettes.length + 1}`;
    const palette = {
        name: name,
        colors: [...currentPalette],
        created: new Date().toISOString()
    };
    
    savedPalettes.push(palette);
    localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
    
    currentPalette = [];
    document.getElementById('palette-name').value = '';
    renderCurrentPalette();
    renderSavedPalettes();
}

// Rendera sparade paletter
function renderSavedPalettes() {
    const container = document.getElementById('saved-palettes');
    container.innerHTML = '';
    
    if (savedPalettes.length === 0) {
        container.innerHTML = '<div style="color: #a0aec0; text-align: center;">Inga sparade paletter</div>';
        return;
    }
    
    savedPalettes.forEach((palette, index) => {
        const item = document.createElement('div');
        item.className = 'saved-palette-item';
        
        const info = document.createElement('div');
        info.className = 'palette-info';
        
        const name = document.createElement('div');
        name.className = 'palette-name';
        name.textContent = palette.name;
        
        const colors = document.createElement('div');
        colors.className = 'palette-colors';
        
        palette.colors.forEach(color => {
            const colorBox = document.createElement('div');
            colorBox.className = 'palette-color-small';
            colorBox.style.backgroundColor = color.hex;
            colorBox.title = color.name;
            colors.appendChild(colorBox);
        });
        
        info.appendChild(name);
        info.appendChild(colors);
        
        const actions = document.createElement('div');
        actions.className = 'palette-actions';
        
        const loadBtn = document.createElement('button');
        loadBtn.className = 'icon-button';
        loadBtn.innerHTML = 'üìÇ';
        loadBtn.title = 'Ladda palett';
        loadBtn.onclick = () => loadPalette(index);
        
        const exportBtn = document.createElement('button');
        exportBtn.className = 'icon-button';
        exportBtn.innerHTML = 'üíæ';
        exportBtn.title = 'Exportera palett';
        exportBtn.onclick = () => exportSinglePalette(index);
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'icon-button';
        deleteBtn.innerHTML = 'üóëÔ∏è';
        deleteBtn.title = 'Ta bort palett';
        deleteBtn.onclick = () => deletePalette(index);
        
        actions.appendChild(loadBtn);
        actions.appendChild(exportBtn);
        actions.appendChild(deleteBtn);
        
        item.appendChild(info);
        item.appendChild(actions);
        container.appendChild(item);
    });
}

// Ladda palett
function loadPalette(index) {
    currentPalette = [...savedPalettes[index].colors];
    renderCurrentPalette();
}

// Ta bort palett
function deletePalette(index) {
    if (confirm(`Vill du ta bort "${savedPalettes[index].name}"?`)) {
        savedPalettes.splice(index, 1);
        localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
        renderSavedPalettes();
    }
}

// Exportera en palett
function exportSinglePalette(index) {
    const palette = savedPalettes[index];
    const json = JSON.stringify(palette, null, 2);
    
    document.getElementById('export-json').value = json;
    document.getElementById('export-modal').classList.add('active');
}

// Exportera alla paletter
function exportAllPalettes() {
    if (savedPalettes.length === 0) {
        alert('Inga paletter att exportera!');
        return;
    }
    
    const exportData = {
        version: "1.0",
        exported: new Date().toISOString(),
        palettes: savedPalettes
    };
    
    const json = JSON.stringify(exportData, null, 2);
    document.getElementById('export-json').value = json;
    document.getElementById('export-modal').classList.add('active');
}

// Importera paletter
function importPalettes(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            
            // Hantera b√•de enskilda paletter och flera paletter
            if (data.palettes) {
                // Flera paletter
                savedPalettes.push(...data.palettes);
            } else if (data.colors) {
                // Enskild palett
                savedPalettes.push(data);
            } else {
                alert('Ogiltig JSON-fil!');
                return;
            }
            
            localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
            renderSavedPalettes();
            alert('Paletter importerade!');
        } catch (error) {
            alert('Fel vid import: ' + error.message);
        }
    };
    reader.readAsText(file);
    
    // √Öterst√§ll file input
    event.target.value = '';
}

// Rensa alla paletter
function clearAllPalettes() {
    if (confirm('Vill du verkligen ta bort ALLA sparade paletter? Detta kan inte √•ngras!')) {
        savedPalettes = [];
        localStorage.setItem('colorPalettes', JSON.stringify(savedPalettes));
        renderSavedPalettes();
    }
}

// Kopiera till urklipp
function copyToClipboard() {
    const json = document.getElementById('export-json');
    json.select();
    document.execCommand('copy');
    alert('Kopierat till urklipp!');
}

// Ladda ner JSON
function downloadJSON() {
    const json = document.getElementById('export-json').value;
    const blob = new Blob([json], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `color-palettes-${new Date().getTime()}.json`;
    a.click();
    URL.revokeObjectURL(url);
}

// St√§ng modal
function closeModal() {
    document.getElementById('export-modal').classList.remove('active');
}

// Initiera vid sidladdning
document.addEventListener('DOMContentLoaded', function() {
    // Ladda sparade paletter fr√•n localStorage
    const stored = localStorage.getItem('colorPalettes');
    if (stored) {
        try {
            savedPalettes = JSON.parse(stored);
        } catch (e) {
            savedPalettes = [];
        }
    }
    
    // Rendera komponenter
    renderCurrentPalette();
    renderSavedPalettes();
    
    // S√§tt initial f√§rg
    updateColorDisplay(currentColor);
});

// St√§ng modal vid klick utanf√∂r
document.getElementById('export-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>
</body>
</html>